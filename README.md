# clj-mergetool

A git diff and merge tool for edn and clojure code.
Symantic diffs for conflict free merges.

For example given the following deps.edn

```clj
{:deps {org.clojure/clojure {:mvn/version "1.10.1"}
        org.clojure/core.async {:mvn/version "1.3.610"}}}
```

One user adds a dependency:

```clj
{:deps {org.clojure/clojure {:mvn/version "1.10.1"}
        org.clojure/core.async {:mvn/version "1.3.610"}
        clj-http {:mvn/version "3.11.0"}}}
```

Another user upgrades a dependency:

```clj
{:deps {org.clojure/clojure {:mvn/version "1.10.1"}
        org.clojure/core.async {:mvn/version "1.3.610"}}}
```

Git's line based diff produces the following conflict:

```
    {:deps {org.clojure/clojure {:mvn/version "1.10.1"}
    <<<<<<< HEAD
            org.clojure/core.async {:mvn/version "1.3.612"}}}
    =======
            org.clojure/core.async {:mvn/version "1.3.610"}
            clj-http {:mvn/version "3.11.0"}}}
    >>>>>>> right
```

Git line diff does not recognize these as logically independant changes. Also manually merging this change requires extra attention to the closing brackets.

What does clj mergetool do differently?

clj mergetool diffs the data structures rather then the lines.
(currently using editscript here, but this is likely to change)

The left diff might be represented as a replacement of the value at a given path (eg assoc-in)

```clj
[[[:deps org.clojure/core.async :mvn/version] :r "1.3.612"]]
```

The right diff adds a new entry

```clj
[[[:deps clj-http] :+ {:mvn/version "3.11.0"}]]
```

Combined:

```clj
[[[:deps org.clojure/core.async :mvn/version] :r "1.3.612"] [[:deps clj-http] :+ {:mvn/version "3.11.0"}]]
```

The resulting patch is conflict free:

```clj
{:deps {org.clojure/clojure {:mvn/version "1.10.1"}
        org.clojure/core.async {:mvn/version "1.3.612"}
        clj-http {:mvn/version "3.11.0"}}}
```

# Usage

TBD.
Started March 2024

## License

Copyright Â© 2024 Kurt Harriger

_EPLv1.0 is just the default for projects generated by `clj-new`: you are not_
_required to open source this project, nor are you required to use EPLv1.0!_
_Feel free to remove or change the `LICENSE` file and remove or update this_
_section of the `README.md` file!_

Distributed under the Eclipse Public License version 1.0.
